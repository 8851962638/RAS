{% extends "base1.html" %}
{% load static %}

{% block title %}Reviews & Feedback - RColourcraft{% endblock %}

{% block extra_head %}
  {% endblock %}

{% block content %}
   <style>

  

        /* Reviews Section */
        .reviews-section {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .reviews-section h2 {
            text-align: center;
            font-size: 1.9rem;
            margin-bottom: 35px;
            color: #2c3e50;
            font-weight: 600;
        }

        /* Reviews Grid - Optimal sizing */
        .reviews-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 22px;
            margin-bottom: 35px;
        }

        /* Review Card - Clean design */
        .review-card {
            background: white;
            border-radius: 10px;
            padding: 22px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 200px;
        }

        .review-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .review-card img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 14px;
            border: 2.5px solid #667eea;
        }

        .review-content {
            flex: 1;
            width: 100%;
        }

        .review-content h3 {
            font-size: 1.05rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }

   

        .review-content p {
            font-size: 0.92rem;
            color: #555;
            line-height: 1.5;
            font-style: italic;
            margin-top: 8px;
        }

        /* Form Section */
        .gallery-section {
            padding: 50px 20px;
            background: linear-gradient(135deg, #9bdded, hsl(125, 59%, 84%));
        }

        .review-form {
            max-width: 550px;
            margin: 0 auto;
            background: white;
            padding: 35px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .review-form h3 {
            text-align: center;
            font-size: 1.7rem;
            margin-bottom: 28px;
            color: #2c3e50;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .review-form input[type="text"],
        .review-form input[type="email"],
        .review-form textarea {
            width: 100%;
            padding: 11px 14px;
            border: 1.5px solid #ddd;
            border-radius: 7px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
            margin-bottom: 14px;
            font-family: inherit;
        }

        .review-form input:focus,
        .review-form textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .review-form label,
        .review-form p {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        /* Star Rating */
        .star-rating {
            display: flex;
            flex-direction: row-reverse;
            justify-content: center;
            gap: 4px;
            margin: 16px 0 20px 0;
        }

    

        .star-rating label {
            font-size: 1.8rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s ease;
            margin-bottom: 0;
        }


        

        /* File Upload */
        .file-upload-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .file-upload-btn {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-weight: 600;
        }

        .file-upload-btn:hover {
            background: #5568d3;
        }

        .file-upload-input {
            display: none;
        }

        .file-name-text {
            color: #666;
            font-size: 0.9rem;
        }

        /* Submit Button */
        .review-form button[type="submit"] {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .review-form button[type="submit"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .text-center {
            text-align: center;
        }

        #response {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        .review-card img.profile-pic {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
}

.review-card .review-img {
  max-width: 100%;
  margin-top: 10px;
  border-radius: 10px;
}

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .reviews-grid {
                grid-template-columns: 1fr;
            }

            .review-form {
                padding: 30px 20px;
            }
        }
    </style>
  <section class="hero">
    <h1>What Our Customers Say</h1>
    <p>Your words inspire us. Your art tells the story.</p>
  </section>

  <section class="reviews-section">
    <h2>Customer Reviews</h2>
    <div class="reviews-grid" id="reviewsGrid">
      <div class="review-card">
        <img src="{% static 'gallery/john.jpg' %}" alt="John D">
        <div class="review-content">
          <h3>John D. <span class="stars">⭐ ⭐ ⭐ ⭐ ⭐</span></h3>
          <p>"Amazing wall art! Totally transformed my living room."</p>
        </div>
      </div>
      <div class="review-card">
        <img src="{% static 'gallery/rohit.jpg' %}" alt="Rohit">
        <div class="review-content">
          <h3>Emily R. <span class="stars">⭐ ⭐ ⭐ ⭐</span></h3>
          <p>"The 3D painting is stunning, it feels alive!"</p>
        </div>
      </div>
      <div class="review-card">
        <img src="{% static 'gallery/rahul.jpg' %}" alt="Rahul S">
        <div class="review-content">
          <h3>Rahul S. <span class="stars">⭐ ⭐ ⭐ ⭐ ⭐</span></h3>
          <p>"Very professional team, highly recommended."</p>
        </div>
      </div>
      {% for r in reviews %}
  <div class="review-card">
    <!-- Profile picture from customer account -->
    {% if r.customer.customer_photo %}
      <img src="{{ r.customer.customer_photo.url }}" alt="{{ r.customer_name }}">
    {% else %}
      <img src="{% static 'gallery/default-user.png' %}" alt="User">
    {% endif %}
    
    <div class="review-content">
      <h3>{{ r.customer_name }}
        <span class="stars">
          {% for i in "12345"|make_list %}
            {% if forloop.counter <= r.rating %}
              ⭐
            {% else %}
              ☆
            {% endif %}
          {% endfor %}
        </span>
      </h3>
      <p>"{{ r.customer_review }}"</p>
      
      <!-- Review image (uploaded with review) -->
      {% if r.review_image %}
        <img src="{{ r.review_image.url }}" alt="Review Image" class="review-img" style="max-width: 100%; margin-top: 10px; border-radius: 8px;">
      {% endif %}
    </div>
  </div>
{% empty %}
{% endfor %}
    </div>
  </section>

  <section class="gallery-section">
    <div class="review-form">
      <h3>Leave a Review</h3>
      <form id="reviewForm" enctype="multipart/form-data" method="post">
        {% csrf_token %}
        <input type="text" name="name" placeholder="Your Name" required>
        <input type="email" name="email" placeholder="Your Email" required>
        <textarea name="customer_review" rows="4" placeholder="Your Review"></textarea>
        <label>Your Rating:</label>
        <div class="star-rating">
          <input class="star star-5" id="star-5" type="radio" name="rating" value="5"/>
          <label class="star star-5" for="star-5"></label>
          <input class="star star-4" id="star-4" type="radio" name="rating" value="4"/>
          <label class="star star-4" for="star-4"></label>
          <input class="star star-3" id="star-3" type="radio" name="rating" value="3"/>
          <label class="star star-3" for="star-3"></label>
          <input class="star star-2" id="star-2" type="radio" name="rating" value="2"/>
          <label class="star star-2" for="star-2"></label>
          <input class="star star-1" id="star-1" type="radio" name="rating" value="1"/>
          <label class="star star-1" for="star-1"></label>
        </div>

    <div class="form-group">
  <p>Upload your picture (optional):</p>
  <div class="file-upload-container">
    <label for="image" class="file-upload-btn">Choose File</label>
    <span id="file-name-display" class="file-name-text">No file chosen</span>
    <input type="file" name="image" id="image" class="file-upload-input">
  </div>
</div>




<div class="form-group text-center">
  <button type="submit">Submit Review</button>
</div>

      </form>

      <div id="response" style="margin-top:12px"></div>
    </div>
  </section>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script>
function submitReview() {
  const form = $('#reviewForm')[0];
  const formData = new FormData(form);
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  $.ajax({
    url: "{% url 'save_review' %}",
    type: "POST",
    data: formData,
    processData: false,
    contentType: false,
    headers: { "X-CSRFToken": csrftoken },
    success: function(data){
      if (data.success) {
        $("#response").html(`<div style='color:green; margin-bottom:8px'>${data.message}</div>`);
        
        // ✅ Profile pic comes from customer account
        const profilePic = data.data.profile_pic ? data.data.profile_pic : "{% static 'gallery/default-user.png' %}";
        
        // ✅ Review image is the uploaded image (optional)
        const reviewImage = data.data.image ? data.data.image : null;
        
        const stars = "⭐".repeat(Number(data.data.rating || 0));
        const reviewText = data.data.customer_review || "";
        
        // ✅ Create review card with profile pic (not review image)
        const newCard = `
          <div class="review-card">
            <img src="${profilePic}" alt="${data.data.name}">
            <div class="review-content">
              <h3>${data.data.name} <span class="stars">${stars}</span></h3>
              <p>"${reviewText}"</p>
              ${reviewImage ? `<img src="${reviewImage}" alt="Review Image" class="review-img" style="max-width: 100%; margin-top: 10px; border-radius: 8px;">` : ''}
            </div>
          </div>`;
        
        $("#reviewsGrid").prepend(newCard);
        $("#reviewForm")[0].reset();
        $("#file-name-display").text("No file chosen");
      } else {
        if (data.errors) {
          let html = "<ul style='color:red; text-align:left; display:inline-block;'>";
          for (const k in data.errors) html += `<li>${k}: ${data.errors[k].join(", ")}</li>`;
          html += "</ul>";
          $("#response").html(html);
        } else {
          $("#response").html(`<div style='color:red'>${data.error || "Submission failed"}</div>`);
        }
      }
    },
    error: function(xhr){
      console.log("AJAX error", xhr.status, xhr.responseText);
      let msg = "Something went wrong.";
      try { const err = JSON.parse(xhr.responseText); if (err.error) msg = err.error; } catch(e){}
      $("#response").html(`<div style='color:red'>${msg}</div>`);
    }
  });
}

$(document).ready(function(){
  console.log("✅ review.js loaded");
  $("#reviewForm").on("submit", function(e){
    e.preventDefault();
    console.log("✅ Intercepted form submit");
    submitReview();
  });

  $("#image").on("change", function(e){
    const fileName = e.target.files.length > 0 ? e.target.files[0].name : "No file chosen";
    $("#file-name-display").text(fileName);
  });
});
</script>

<style>
  .gallery-section {
    padding: 50px 20px;
    background: linear-gradient(135deg, #9bdded, hsl(125, 59%, 84%));
    text-align: center;
}

</style>

  
{% endblock %}