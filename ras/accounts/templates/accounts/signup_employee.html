{% extends 'base.html' %}
{% load static %}


{% block title %}Signup - Painting{% endblock %}

{% block content %}
<div class="auth-container">
  <div class="auth-box">
    <h1>Create Account üñåÔ∏è</h1>
    <p class="subtitle">Join us and showcase your art</p>

    <form id="signupForm" method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <!-- Full Name -->
      <div class="input-group">
        <label for="full_name">Full Name</label>
        <input type="text" id="full_name" name="full_name" required>
      </div>

      <!-- Father's Name -->
      <!-- <div class="input-group">
        <label for="fathers_name">Father's Name</label>
        <input type="text" id="fathers_name" name="fathers_name" required>
      </div>

      
      <div class="input-group">
        <label for="dob">Date of Birth</label>
        <input type="date" id="dob" name="dob" required>
      </div> -->

      <!-- Gender -->
      <!-- <div class="input-group">
        <label for="gender">Gender</label>
        <input type="text" id="gender" name="gender" placeholder="Male/Female/Other" required>
      </div> -->

      <!-- Mobile -->
      <div class="input-group">
        <label for="mobile">Mobile</label>
        <input type="text" id="mobile" name="mobile" required>
      </div>

      <!-- Email -->
      <div class="input-group">
        <label for="email_address">Email</label>
        <input type="email" id="email_address" name="email_address" required>
      </div>


<div class="input-group" style="position: relative;">
  <label for="password">Password</label>
  <input type="password" id="password" name="password" required> <!-- add padding so text doesn't overlap the icon -->

  <img id="togglePassword" src="{% static 'gallery/hide.png' %}" 
       alt="Toggle Password"
       style="position: absolute; top: 70%; right: 10px; transform: translateY(-50%);
              width: 24px; height: 24px; cursor: pointer;"
       onclick="togglePassword()">
</div>

      <!-- Address -->
      <!-- <div class="input-group">
        <label for="house_no">House No</label>
        <input type="text" id="house_no" name="house_no" required>
      </div> -->

      <!-- <div class="input-group">
        <label for="village">Village</label>
        <input type="text" id="village" name="village" required>
      </div> -->

      <!-- <div class="input-group">
        <label for="city">City</label>
        <input type="text" id="city" name="city" required>
      </div> -->

      <!-- <div class="input-group">
        <label for="state">State</label>
        <input type="text" id="state" name="state" required>
      </div> -->

      <!-- <div class="input-group">
        <label for="pincode">Pincode</label>
        <input type="text" id="pincode" name="pincode" required>
      </div> -->

      <!-- Aadhaar -->
      <!-- <div class="input-group">
        <label for="aadhar_card_no">Aadhar Card No</label>
        <input type="text" id="aadhar_card_no" name="aadhar_card_no" required>
      </div>

      <div class="input-group">
        <label for="aadhar_card_image_front">Aadhar Card (Front)</label>
        <input type="file" id="aadhar_card_image_front" name="aadhar_card_image_front" required>
      </div>

      <div class="input-group">
        <label for="aadhar_card_image_back">Aadhar Card (Back)</label>
        <input type="file" id="aadhar_card_image_back" name="aadhar_card_image_back" required>
      </div> -->

      <!-- Experience -->
      <!-- <div class="input-group">
        <label for="experience">Experience(years)</label>
        <input type="number" id="experience" name="experience" min="0" required>
      </div> -->

      <!-- Type of Work (Checkboxes) -->
      <!-- <div class="input-group">
        <label>Type of Work</label>
        <div>
          <input type="checkbox" id="work_3d" name="type_of_work" value="3D Art">
          <label for="work_3d">3D Art</label>
        </div>
        <div>
          <input type="checkbox" id="work_mural" name="type_of_work" value="Mural Art">
          <label for="work_mural">Mural Art</label>
        </div>
        <div>
          <input type="checkbox" id="work_normal" name="type_of_work" value="Normal Paint">
          <label for="work_normal">Normal Paint</label>
        </div>
        <div>
          <input type="checkbox" id="work_2d" name="type_of_work" value="2D Art">
          <label for="work_2d">2D Art</label>
        </div>
        <div>
          <input type="checkbox" id="work_digital" name="type_of_work" value="Digital Art">
          <label for="work_digital">Digital Art</label>
        </div>
      </div> -->

      <!-- Preferred Work Location -->
      <!-- <div class="input-group">
        <label for="preferred_work_location">Preferred Work Location</label>
        <input type="text" id="preferred_work_location" name="preferred_work_location" required>
      </div> -->
      
      <!-- Working Area -->
       <!-- <div class="input-group">
         <label for="working_area">Working Area (in km)</label>
         <input type="number" id="working_area" name="working_area" placeholder="Enter kilometers" min="1" required>
       </div> -->


      <!-- Passport Photo -->
      <!-- <div class="input-group">
        <label for="passport_photo">Passport Photo</label>
        <input type="file" id="passport_photo" name="passport_photo" required>
      </div> -->
<!-- 
       Bank Details -->
      <!-- <div class="input-group">
        <label for="bank_account_holder_name">Bank Account Holder Name</label>
        <input type="text" id="bank_account_holder_name" name="bank_account_holder_name" required>
      </div> -->

      <!-- <div class="input-group">
        <label for="account_no">Account No</label>
        <input type="text" id="account_no" name="account_no" required>
      </div> -->

      <!-- <div class="input-group">
        <label for="ifsc_code">IFSC Code</label>
        <input type="text" id="ifsc_code" name="ifsc_code" required>
      </div> --> 

<button type="button" class="btn" onclick="sendEmployeeOTP()">Sign Up</button>
      <p class="switch-text">Already have an account? <a href="{% url 'accounts:login' %}">Login</a></p>
    </form>
  </div>
</div>

<!-- OTP Modal -->
<div id="employeeOtpModal" class="custom-modal">
  <div class="custom-modal-content">
    <span class="close-btn" onclick="closeEmployeeOtpModal()">&times;</span>
    <h3>Email Verification</h3>
    <p>Please enter the OTP sent to your email</p>
    <input type="text" id="employeeOtpInput" maxlength="6" placeholder="Enter OTP" class="otp-input">
    <div class="modal-actions">
      <button type="button" class="btn btn-success" onclick="verifyEmployeeOTP()">Verify ‚úÖ</button>
      <button type="button" class="btn btn-danger" onclick="closeEmployeeOtpModal()">Cancel ‚ùå</button>
    </div>
  </div>
</div>



<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script>



  document.addEventListener("DOMContentLoaded", function() {
    const passwordInput = document.getElementById("password");
    const toggleIcon = document.getElementById("togglePassword");

    toggleIcon.addEventListener("click", function() {
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        toggleIcon.src = "{% static 'gallery/views.png' %}";
      } else {
        passwordInput.type = "password";
        toggleIcon.src = "{% static 'gallery/hide.png' %}";
      }
    });
  });


   
  function sendEmployeeOTP() {
    const form = $('#signupForm')[0];
    const formData = new FormData(form);
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    $.ajax({
        url: '/accounts/save_employee_signup/',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        headers: { "X-CSRFToken": csrftoken },
        xhrFields: { withCredentials: true },   // üëà important
        success: function(response) {
            if(response.success) {
                alert(response.message);
                $('#employeeOtpModal').css("display", "flex");
            } else {
                alert('Error: ' + response.error);
            }
        },
        error: function(xhr) {
            alert('Something went wrong!');
        }
    });
}

function verifyEmployeeOTP() {
    const otp = $('#employeeOtpInput').val();
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    $.ajax({
        url: '/accounts/verify_employee_otp/',
        type: 'POST',
        data: { otp: otp },
        headers: { "X-CSRFToken": csrftoken },
        xhrFields: { withCredentials: true },
        success: function(response) {
            if(response.success) {
                alert(response.message);
                closeEmployeeOtpModal();
                window.location.href = '/accounts/login/';
            } else {

                alert('Error: ' + response.error);
            }
        },
        error: function(xhr) {
            alert('Something went wrong!');
        }
    });
}




function closeEmployeeOtpModal() {
    $('#employeeOtpModal').hide();
}



</script>
<style>
  /* Employee OTP Modal */
#employeeOtpModal {
  display: none;              /* üîπ Hidden by default */
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6); /* overlay */
  justify-content: center;
  align-items: center;
}

#employeeOtpModal .custom-modal-content {
  background: #fff;
  padding: 25px;
  border-radius: 10px;
  width: 350px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

#employeeOtpModal .close-btn {
  position: absolute;
  right: 15px;
  top: 10px;
  font-size: 20px;
  cursor: pointer;
}

</style>
{% endblock %}
