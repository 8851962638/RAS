{% extends "base1.html" %}
{% load static %}

{% block title %}Book {{ service_name }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<div class="booking-container">
  <form class="booking-form" id="bookingForm" method="POST">
    {% csrf_token %}
    <h2>Book {{ service_name }}</h2>

    <label>Service</label>
    <input type="text" name="service_name" value="{{ service_name }}" readonly>

    <div class="contact-row">
      <div class="contact-field">
        <label>Contact Number</label>
        <input type="text" name="contact_number" placeholder="Enter Contact Number" required>
      </div>
      <div class="contact-field">
        <label>Email</label>
        <input type="email" name="email" placeholder="Enter Email" required>
      </div>
    </div>

    <label>Address</label>
    <textarea name="address" placeholder="Enter Full Address" required></textarea>

    <div class="address-row">
      <div class="address-field">
        <label>Pin Code</label>
        <input type="text" name="pin_code" placeholder="Pin Code" required>
      </div>
      <div class="address-field">
        <label>State</label>
        <input type="text" name="state" placeholder="State" required>
      </div>
      <div class="address-field">
        <label>City</label>
        <input type="text" name="city" placeholder="City" required>
      </div>
    </div>

    <label>Total Walls</label>
    <input type="number" name="total_walls" placeholder="Enter Total Number of Walls" required>

    <div class="square-appointment-row">
      <div class="square-ft">
        <label>Square Ft</label>
        <div class="square-ft-inputs">
          <input type="number" id="width" name="width" placeholder="Width" required>
          <span>*</span>
          <input type="number" id="height" name="height" placeholder="Height" required>
          <span>=</span>
          <input type="number" id="total_sqft" name="total_sqft" placeholder="Total sq ft" readonly>
        </div>
      </div>
    </div>

    <div class="appointment-date">
      <label for="appointment_date">Appointment Date</label>
      <input type="date" class="colorful-input date-input" id="appointment_date" name="appointment_date" required>
    </div>

    <button type="button" onclick="saveBooking()">Submit</button>

  </form>
</div>

<!-- Popup Modal -->
<div id="popup" class="popup-overlay">
  <div class="popup-box">
    <h3>Booking Successful ðŸŽ‰</h3>
    <p>Your booking for <strong>{{ service_name }}</strong> is successful! <br>
    Our team will get in touch with you within 24 hours.</p>
    <button onclick="goHome()">Okay</button>
  </div>
</div>

<style>
.booking-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 80vh;
  padding: 2rem;
}

.booking-form {
  background: #f9f9f9;
  padding: 2rem 3rem;
  border-radius: 15px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  width: 100%;
  max-width: 800px;
}

.booking-form h2 {
  text-align: center;
  font-size: 2rem;
  margin-bottom: 1.5rem;
  background: linear-gradient(90deg, #7b2ff7, #00c6ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.booking-form label {
  display: block;
  margin-top: 1rem;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.booking-form input, 
.booking-form textarea {
  width: 100%;
  padding: 0.6rem 0.8rem;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1rem;
}

.booking-form textarea {
  resize: vertical;
}

.contact-row {
  display: flex;
  gap: 1rem;
}
.contact-field {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.address-row {
  display: flex;
  gap: 1rem;
  margin-top: 0.5rem;
}
.address-field {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.square-ft {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 0.5rem;
}
.square-ft input {
  width: 114px;
  text-align: center;
}

.booking-form button {
  width: 100%;
  padding: 0.8rem;
  margin-top: 1.5rem;
  border: none;
  border-radius: 10px;
  background: linear-gradient(135deg, #7b2ff7, #00c6ff);
  color: white;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
.booking-form button:hover {
  opacity: 0.9;
}

.square-appointment-row {
  display: flex;
  gap: 1.5rem;
  align-items: flex-end;
  margin-top: 1rem;
}

.square-ft {
  flex: 1;
}

.square-ft-inputs {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.square-ft-inputs input {
  width: 106px;
  text-align: center;
}

.appointment-date {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.date-input {
  border: 2px solid #7b2ff7;
  border-radius: 8px;
  padding: 0.6rem;
  font-size: 1rem;
  background: #f9f9ff;
  transition: all 0.3s ease;
}

.date-input:focus {
  border-color: #00c6ff;
  box-shadow: 0 0 10px rgba(0, 198, 255, 0.6);
  background: #ffffff;
}



/* Popup styles */
.popup-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
}
.popup-box {
  background: #fff;
  padding: 2rem;
  border-radius: 12px;
  text-align: center;
  max-width: 400px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
.popup-box h3 {
  margin-bottom: 1rem;
  color: #28a745;
}
.popup-box button {
  margin-top: 1rem;
  padding: 0.6rem 1.2rem;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, #7b2ff7, #00c6ff);
  color: #fff;
  font-size: 1rem;
  cursor: pointer;
}
.popup-box button:hover {
  opacity: 0.9;
}

@media (max-width: 768px) {
  .address-row,
  .contact-row {
    flex-direction: column;
  }
}

</style>

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
// Auto-calculate total square feet
const widthInput = document.getElementById('width');
const heightInput = document.getElementById('height');
const totalInput = document.getElementById('total_sqft');

function calculateTotal() {
    const w = parseFloat(widthInput.value) || 0;
    const h = parseFloat(heightInput.value) || 0;
    totalInput.value = w * h;
}
widthInput.addEventListener('input', calculateTotal);
heightInput.addEventListener('input', calculateTotal);

// Popup handling
// const form = document.getElementById('bookingForm');
// const popup = document.getElementById('popup');

// form.addEventListener('submit', function(e) {
//   e.preventDefault(); 
//   popup.style.display = 'flex'; 
// });

function goHome() {
  window.location.href = "{% url 'home' %}";
}




flatpickr("#appointment_date", {
  dateFormat: "d-m-Y",
  minDate: "today",  // disable past dates
  theme: "material_blue", // you can use "airbnb", "dark", "material_green", etc.
});


//for saving data of booking

function saveBooking() {
    // auto-calc total sqft before saving
    alert("s")
    let width = parseFloat($('#width').val()) || 0;
    let height = parseFloat($('#height').val()) || 0;
    $('#total_sqft').val(width * height);

    const form = $('#bookingForm')[0];
    const formData = new FormData(form);

    $.ajax({
        url: '/home/save_bookings/',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        headers: { "X-CSRFToken": $('[name=csrfmiddlewaretoken]').val() },
        success: function(response) {
            if(response.success) {
                $('#popup').fadeIn();
                $('#bookingForm')[0].reset();
            } else {
                alert('Error: ' + response.message);
            }
        },
        error: function(xhr) {
            alert('Something went wrong: ' + xhr.responseText);
        }
    });
}
</script>
{% endblock %}
